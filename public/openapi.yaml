openapi: 3.1.0
info:
  title: Wing Open API Market Place
  version: "v5.0.0+v2.0.3"
  description: |
    - **Overview for DeepLink**:
    **The wing API documentation** provides pragmatic access to wing system.
    This document is a technical specification for interaction between
    wing systems and third party. It describes how message is defined
    and transmitted between Wing and Third party.

    **HTTP Methods and Response Codes**:
    All actions taken through the API follow REST conventions via HTTPS
    using standard HTTPS methods: GET (to retrieve an object), POST (to create).

    **Input/Output Format**:
    Request body data is expected to be in JSON, and the response body
    data is returned as JSON.

    **Requests and Responses**:
    Every request must send an access token in the header of the request
    (Authorization: Bearer access_token) for both POST and GET requests
    (excluding requests for token retrieval).

    **Example Requests and Responses**:
    For every API method, we provide a sample request and a sample response
    in plain text format.

    **Authentication**:
    To access the Wing API, username, password, Client ID, and Client Secret
    are required to authenticate the request. Once authentication fails,
    any access from third party will be blocked.

    **Token**:
    Access token is generated by Wing API and provided to third party software
    clients to identify the request identity. Once token authentication fails,
    any access from third party will be blocked.

    - **Overview for Web SDK**:
    **The wing API documentation** provides pragmatic access to wing online payment gateway for web 
    SDK. This document is a technical specification for interaction between wing online payment 
    gateways with third parties. It describes how message is defined and transmitted between Wing 
    and third parties.

servers:
  - url: "/api/deeplink"
    description: DeepLink testing staging
  - url: "/api/sdk"
    description: Web SDK testing staging

security:
  - BearerAuth: []

paths:
  /RestServer/oauth/token:
    parameters: []
    post:
      tags: [DeepLink]
      summary: Get Token
      description: |
        Obtain a bearer access token for DeepLink APIs. **Token lifetime:** about 5 minutes.
      security: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
                  format: password
                client_id:
                  type: string
                client_secret:
                  type: string
                grant_type:
                  type: string
                  enum: ["password"]
              required:
                - username
                - password
                - client_id
                - client_secret
                - grant_type
      responses:
        '200':
          description: Access token successfully issued.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessTokenResponse'
        '401':
          description: Authentication failed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthErrorResponse'

  /RestServer/api/v4/generatedeeplink:
    post:
      tags: [DeepLink]
      summary: Create Deep Link
      operationId: dlGenerateDeepLink
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDeepLinkRequest'
      responses:
        '200':
          description: Deep link created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateDeepLinkResponse'

  /RestServer/api/v1/checktxnstatus:
    post:
      tags: [DeepLink]
      summary: Check Transaction Status
      operationId: dlCheckTransactionStatus
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckTxnStatusRequest'
      responses:
        '200':
          description: Status retrieved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckTxnStatusResponse'

  /v1/online/payment/authorization:
    post:
      tags: [Web SDK]
      summary: Get Token
      operationId: webAuthorizePayment
      parameters:
        - $ref: '#/components/parameters/RefererHeader'
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthorizationRequest'
      responses:
        '200':
          description: Access token successfully issued.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthorizationResponse'

  /v1/online/payment/confirm:
    get:
      tags: [Web SDK]
      summary: Open Payment Page
      operationId: webConfirmPayment
      parameters:
        - name: token
          in: query
          required: true
          schema: { type: string }
          description: Base64-encoded authorization token.
      responses:
        '200':
          description: Hosted checkout page.
          content:
            text/html:
              schema: { type: string }

  /v2/online/payment/transaction/inquiry:
    post:
      tags: [Web SDK]
      summary: Inquiry Transaction Status
      operationId: webInquiryTransaction
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InquiryRequest'
      responses:
        '200':
          description: Inquiry result.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InquiryResponse'

# ===============================
# ðŸ“Œ FULL MERGED COMPONENTS START
# ===============================
components:
  securitySchemes:
    BearerAuth:        # Used by DeepLink APIs
      type: http
      scheme: bearer
      bearerFormat: JWT

    bearerAuth:        # Used by Web SDK APIs
      type: http
      scheme: bearer
      bearerFormat: token

  parameters:
    RefererHeader:
      name: Referer
      in: header
      required: true
      description: Base64-encoded partner URL or domain
      schema:
        type: string

  schemas:

    AccessTokenResponse:
      type: object
      properties:
        access_token: { type: string }
        token_type: { type: string }
        expires_in: { type: integer }
      required: [access_token, token_type, expires_in]

    AuthErrorResponse:
      type: object
      properties:
        error: { type: string }
        error_description: { type: string }
      required: [error, error_description]

    ErrorResponse:
      type: object
      properties:
        error_code: { type: string }
        error_text: { type: string }
      required: [error_code, error_text]

    CreateDeepLinkRequest:
      type: object
      properties:
        order_reference_no: { type: string }
        amount: { type: string }
        currency:
          type: string
          enum: [USD, KHR]
        merchant_name: { type: string }
        merchant_id: { type: string }
        item_name: { type: string }
        schema_url: { type: string }
        integration_type: { type: string }
        txn_hash: { type: string }
        product_detail:
          type: array
          items:
            $ref: '#/components/schemas/ProductDetailItem'
      required:
        - order_reference_no
        - amount
        - currency
        - merchant_name
        - merchant_id
        - item_name
        - schema_url
        - integration_type
        - txn_hash
        - product_detail

    ProductDetailItem:
      type: object
      properties:
        product_id: { type: string }
        product_type: { type: string }
        product_qty: { type: integer }
        product_unit_price: { type: number }
        currency:
          type: string
          enum: [USD, KHR]
      required:
        - product_id
        - product_type
        - product_qty
        - currency

    CreateDeepLinkResponse:
      type: object
      properties:
        error_code: { type: string }
        error_text: { type: string }
        amount: { type: string }
        currency: { type: string }
        pre_order_id: { type: string }
        merchant_name: { type: string }
        merchant_id: { type: string }
        item_name: { type: string }
        redirect_url: { type: string }
      required: [error_code, error_text]

    CheckTxnStatusRequest:
      type: object
      properties:
        order_reference_no: { type: string }
        merchant_name: { type: string }
      required: [order_reference_no, merchant_name]

    CheckTxnStatusResponse:
      type: object
      properties:
        error_code: { type: string }
        error_text: { type: string }
        amount: { type: string }
        currency: { type: string }
        status:
          type: string
          enum: [TI, TF, TS]
        pre_order_id: { type: string }
        ref_number: { type: string }
        partner_id: { type: string }
        transaction_id: { type: string }
      required: [error_code, error_text]

    AuthorizationRequest:
      type: object
      properties:
        username: { type: string }
        rest_api_key: { type: string }
        payload: { type: string }
        hash: { type: string }
        sandbox:
          type: string
          enum: ["0", "1"]
      required: [username, rest_api_key, payload, hash, sandbox]

    AuthorizationResponse:
      type: object
      properties:
        errorCode: { type: string }
        errorText: { type: string }
        token: { type: string, nullable: true }
      required: [errorCode, errorText]

    AuthorizationErrorResponse:
      type: object
      properties:
        error_code: { type: string }
        error_text: { type: string }
        token: { type: string }
      required: [error_code, error_text, token]

    InquiryRequest:
      type: object
      properties:
        username: { type: string }
        rest_api_key: { type: string }
        order_reference_no: { type: string }
        sandbox:
          type: string
          enum: ["0", "1"]
      required: [username, rest_api_key, order_reference_no, sandbox]

    InquiryResponse:
      type: object
      properties:
        errorCode: { type: string }
        errorText: { type: string }
        respType: { type: string }
        amount: { type: string }
        total_amount: { type: string }
        currency: { type: string }
        order_reference_no: { type: string }
        remark: { type: string }
        customer_name: { type: string }
        customer_fee: { type: string }
        customer_fee_currency: { type: string }
        wing_account: { type: string }
        transaction_id: { type: string }
        biller_name: { type: string }
        transaction_date:
          type: integer
          format: int64
      required: [errorCode]

    CallbackEnvelope:
      type: object
      properties:
        contents: { type: string }
      required: [contents]

    CallbackDecryptedPayloadDeepLink:
      type: object
      properties:
        callback_url: { type: string }
        transaction_id: { type: string }
        transaction_date: { type: string }
        amount: { type: string }
        total_amount: { type: string }
        order_reference_no: { type: string }
        fee: { type: string }
        rest_api_key: { type: string }
        currency: { type: string }
        account: { type: string }

    CallbackDecryptedPayloadWebSDK:
      type: object
      properties:
        amount: { type: string }
        total_amount: { type: string }
        currency: { type: string }
        order_reference_no: { type: string }
        remark: { type: string }
        customer_name: { type: string }
        fee: { type: string }
        fee_currency: { type: string }
        wing_account: { type: string }
        ps_trn_id: { type: string }
        fc_trn_id: { type: string }
        biller_name: { type: string }
        transaction_date: { type: string }
        transaction_id: { type: string }

